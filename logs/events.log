[2025-05-12 08:23:23] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:23] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:24] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:24] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:24] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:24] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:26] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:26] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:26] [EVENT] Endpoint create_subscription_session.php: Solicitud recibida.
[2025-05-12 08:23:26] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl inicializado con appDomainBase: http://localhost:8000/public
[2025-05-12 08:23:26] [EVENT] Bootstrap: StripeCheckoutSessionService instanciado.
[2025-05-12 08:23:26] [EVENT] create_subscription_session.php: Llamando a createSubscriptionSession. - Context: {"lookup_key":"annual_payment"}
[2025-05-12 08:23:26] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Creando sesión de suscripción. - Context: {"lookup_key":"annual_payment"}
[2025-05-12 08:23:26] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Buscando Price ID. - Context: {"lookup_key":"annual_payment","context":"suscripción"}
[2025-05-12 08:23:26] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Price ID encontrado. - Context: {"lookup_key":"annual_payment","price_id":"price_1RLNsHP71JLI6sb9ez8HJsHt"}
[2025-05-12 08:23:26] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: URLs para suscripción. - Context: {"success":"http://localhost:8000/public/success.html?session_id={CHECKOUT_SESSION_ID}","cancel":"http://localhost:8000/public/cancel.html"}
[2025-05-12 08:23:27] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Sesión de suscripción creada. - Context: {"session_id":"cs_test_a1RL8GOkWt2LunitWGqi2PNflMxkj9NPrvLwiwGRVIDZoA2s7JOvLYleXk","price_id":"price_1RLNsHP71JLI6sb9ez8HJsHt"}
[2025-05-12 08:23:27] [EVENT] create_subscription_session.php: Sesión de suscripción creada. - Context: {"session_id":"cs_test_a1RL8GOkWt2LunitWGqi2PNflMxkj9NPrvLwiwGRVIDZoA2s7JOvLYleXk"}
[2025-05-12 08:23:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:47] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:47] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:47] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:47] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG","event_type":"charge.succeeded"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG","event_type":"charge.succeeded"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG","event_type":"charge.succeeded","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG","event_type":"charge.succeeded"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Charge DTO mapeado. - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG","charge_id":"ch_3RNreHP71JLI6sb90ts1zEE5","pi_id":"pi_3RNreHP71JLI6sb90yE8nXj4","receipt_url":"https://pay.stripe.com/receipts/invoices/CAcaFwoVYWNjdF8xUkhKNjFQNzFKTEk2c2I5KJPghsEGMgaosLbZkPY6LBZz8AkoREz7y0hr5G_9t9J6-_VPh4fUVBWfGyKoSg3OB7oC-dIk7E75lF4s?s=ap"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: No se encontró transacción asociada al Payment Intent del Charge. - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG","pi_id":"pi_3RNreHP71JLI6sb90yE8nXj4","charge_id":"ch_3RNreHP71JLI6sb90ts1zEE5"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG","charge_id":"ch_3RNreHP71JLI6sb90ts1zEE5"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNreHP71JLI6sb90VhiqmDG"}
[2025-05-12 08:23:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:47] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:47] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:47] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:47] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9d9ZkMxgv","event_type":"payment_method.attached"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreJP71JLI6sb9d9ZkMxgv","event_type":"payment_method.attached"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNreJP71JLI6sb9d9ZkMxgv","event_type":"payment_method.attached"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNreJP71JLI6sb9d9ZkMxgv"}
[2025-05-12 08:23:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:47] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:47] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:47] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:47] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreJP71JLI6sb91T2nCDm5","event_type":"customer.created"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreJP71JLI6sb91T2nCDm5","event_type":"customer.created"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNreJP71JLI6sb91T2nCDm5","event_type":"customer.created","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNreJP71JLI6sb91T2nCDm5","event_type":"customer.created"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Customer DTO mapeado. - Context: {"event_id":"evt_1RNreJP71JLI6sb91T2nCDm5","customer_id":"cus_SISZdSpKAhoMO6","email":"contacto@josecarlosdev.com","name":"ANUAL"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNreJP71JLI6sb91T2nCDm5","customer_id":"cus_SISZdSpKAhoMO6"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNreJP71JLI6sb91T2nCDm5","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNreJP71JLI6sb91T2nCDm5"}
[2025-05-12 08:23:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:47] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:47] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:47] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:47] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:47] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9P1JhwOj9","event_type":"checkout.session.completed"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreJP71JLI6sb9P1JhwOj9","event_type":"checkout.session.completed"}
[2025-05-12 08:23:47] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNreJP71JLI6sb9P1JhwOj9","event_type":"checkout.session.completed","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNreJP71JLI6sb9P1JhwOj9","event_type":"checkout.session.completed"}
[2025-05-12 08:23:47] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: DTO CheckoutSession mapeado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9P1JhwOj9","cs_id":"cs_test_a1RL8GOkWt2LunitWGqi2PNflMxkj9NPrvLwiwGRVIDZoA2s7JOvLYleXk","mode":"subscription","customer_id_stripe":"cus_SISZdSpKAhoMO6","customer_email":"contacto@josecarlosdev.com","payment_intent_id":null,"subscription_id":"sub_1RNreIP71JLI6sb9RTCameZY"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Suscripción de Checkout aún no en BD (se esperará a customer.subscription.created). - Context: {"sub_id":"sub_1RNreIP71JLI6sb9RTCameZY","email_from_cs":"contacto@josecarlosdev.com"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9P1JhwOj9","cs_id":"cs_test_a1RL8GOkWt2LunitWGqi2PNflMxkj9NPrvLwiwGRVIDZoA2s7JOvLYleXk"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNreJP71JLI6sb9P1JhwOj9","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNreJP71JLI6sb9P1JhwOj9"}
[2025-05-12 08:23:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:48] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:48] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9lFu0RA2e","event_type":"customer.updated"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreJP71JLI6sb9lFu0RA2e","event_type":"customer.updated"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNreJP71JLI6sb9lFu0RA2e","event_type":"customer.updated","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNreJP71JLI6sb9lFu0RA2e","event_type":"customer.updated"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Customer DTO mapeado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9lFu0RA2e","customer_id":"cus_SISZdSpKAhoMO6","email":"contacto@josecarlosdev.com","name":"ANUAL"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9lFu0RA2e","customer_id":"cus_SISZdSpKAhoMO6"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNreJP71JLI6sb9lFu0RA2e","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNreJP71JLI6sb9lFu0RA2e"}
[2025-05-12 08:23:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:48] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:48] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV","event_type":"customer.subscription.created"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV","event_type":"customer.subscription.created"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV","event_type":"customer.subscription.created","strategy_class":"App\\Strategy\\Impl\\SubscriptionCreatedStrategyImpl"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV","event_type":"customer.subscription.created"}
[2025-05-12 08:23:48] [EVENT] SubscriptionMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Subscription","json_representation_snippet":"{\n    \"id\": \"sub_1RNreIP71JLI6sb9RTCameZY\",\n    \"object\": \"subscription\",\n    \"application\": null,\n    \"application_fee_percent\": null,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null\n    },\n    \"billing_cycle_anchor\": 1747038225,\n    \"billing_cycle_anchor_config\": null,\n    \"cancel_at\": null,\n    \"cancel_at_period_end\": false,\n    \"canceled_at\": null,\n    \"cancellation_details\": {\n        \"comment\": null,\n        \"feedback\": null,\n        \"reason\": null\n    },\n    \"collection_method\": \"charge_automatically\",\n    \"created\": 1747038225,\n    \"currency\": \"eur\",\n    \"customer\": \"cus_SISZdSpKAhoMO6\",\n    \"days_until_due\": null,\n    \"default_payment_method\": \"pm_1RNreGP71JLI6sb9rejE1e0R\",\n    \"default_source\": null,\n    \"default_tax_rates\": [],\n    \"description\": null,\n    \"discounts\": [],\n    \"ended_at\": null,\n    \"invoice_settings\": {\n        \"account_tax_ids\": null,\n        \"issuer\": {\n            \"type\": \"self\"\n        }\n    },\n"}
[2025-05-12 08:23:48] [EVENT] SubscriptionMapper: Usando 'start_date' como 'current_period_start'. - Context: {"sub_id":"sub_1RNreIP71JLI6sb9RTCameZY"}
[2025-05-12 08:23:48] [EVENT] SubscriptionMapper: Usando 'items.data[0].current_period_end'. - Context: {"sub_id":"sub_1RNreIP71JLI6sb9RTCameZY"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Subscription DTO mapeado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV","sub_id":"sub_1RNreIP71JLI6sb9RTCameZY","customer_id":"cus_SISZdSpKAhoMO6","status":"active"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Intentando obtener Customer para email. - Context: {"customer_id":"cus_SISZdSpKAhoMO6"}
[2025-05-12 08:23:48] [EVENT] SubscriptionModelFactory: Creando SubscriptionsModel desde SubscriptionDTO. - Context: {"sub_id":"sub_1RNreIP71JLI6sb9RTCameZY"}
[2025-05-12 08:23:48] [EVENT] SubscriptionModelFactory: SubscriptionsModel creado exitosamente. - Context: {"sub_id":"sub_1RNreIP71JLI6sb9RTCameZY"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Nueva suscripción creada y guardada. - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV","sub_id":"sub_1RNreIP71JLI6sb9RTCameZY"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV","sub_id":"sub_1RNreIP71JLI6sb9RTCameZY"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV","strategy_class":"App\\Strategy\\Impl\\SubscriptionCreatedStrategyImpl"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNreJP71JLI6sb9uzXNfVXV"}
[2025-05-12 08:23:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:48] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:48] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNreHP71JLI6sb90PO9trcz","event_type":"payment_intent.succeeded"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNreHP71JLI6sb90PO9trcz","event_type":"payment_intent.succeeded"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNreHP71JLI6sb90PO9trcz","event_type":"payment_intent.succeeded","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNreHP71JLI6sb90PO9trcz","event_type":"payment_intent.succeeded"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent DTO mapeado. - Context: {"pi_id":"pi_3RNreHP71JLI6sb90yE8nXj4","invoice_id_in_pi_dto":null}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Procesando como pago único directo (sin invoiceId asociado en PI). - Context: {"pi_id":"pi_3RNreHP71JLI6sb90yE8nXj4"}
[2025-05-12 08:23:48] [EVENT] TransactionModelFactory: Preparando TransactionsModel desde PaymentIntentDTO. - Context: {"pi_id":"pi_3RNreHP71JLI6sb90yE8nXj4"}
[2025-05-12 08:23:48] [EVENT] TransactionModelFactory: TransactionsModel (sin ID local aún) preparado desde PaymentIntentDTO. - Context: {"pi_id":"pi_3RNreHP71JLI6sb90yE8nXj4"}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Transacción de pago único directo creada. - Context: {"pi_id":"pi_3RNreHP71JLI6sb90yE8nXj4","local_tx_id":1}
[2025-05-12 08:23:48] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNreHP71JLI6sb90PO9trcz"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNreHP71JLI6sb90PO9trcz","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNreHP71JLI6sb90PO9trcz"}
[2025-05-12 08:23:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:48] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:48] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNreHP71JLI6sb90z1DGLgd","event_type":"payment_intent.created"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNreHP71JLI6sb90z1DGLgd","event_type":"payment_intent.created"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_3RNreHP71JLI6sb90z1DGLgd","event_type":"payment_intent.created"}
[2025-05-12 08:23:48] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_3RNreHP71JLI6sb90z1DGLgd"}
[2025-05-12 08:23:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:48] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:49] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:49] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:49] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:49] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreJP71JLI6sb9SpYiK38I","event_type":"invoice.created"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreJP71JLI6sb9SpYiK38I","event_type":"invoice.created"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNreJP71JLI6sb9SpYiK38I","event_type":"invoice.created"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNreJP71JLI6sb9SpYiK38I"}
[2025-05-12 08:23:49] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:49] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:49] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:49] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:49] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:49] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreKP71JLI6sb9DxEUM8DF","event_type":"invoice.finalized"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreKP71JLI6sb9DxEUM8DF","event_type":"invoice.finalized"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNreKP71JLI6sb9DxEUM8DF","event_type":"invoice.finalized"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNreKP71JLI6sb9DxEUM8DF"}
[2025-05-12 08:23:49] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:49] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:49] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:49] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:49] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:49] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","event_type":"invoice.paid"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","event_type":"invoice.paid"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","event_type":"invoice.paid","strategy_class":"App\\Strategy\\Impl\\InvoicePaidStrategyImpl"}
[2025-05-12 08:23:49] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","event_type":"invoice.paid"}
[2025-05-12 08:23:49] [EVENT] InvoiceMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Invoice","json_representation_snippet":"{\n    \"id\": \"in_1RNreIP71JLI6sb9iurajFt1\",\n    \"object\": \"invoice\",\n    \"account_country\": \"ES\",\n    \"account_name\": \"Stripe Lab App\",\n    \"account_tax_ids\": null,\n    \"amount_due\": 1500,\n    \"amount_overpaid\": 0,\n    \"amount_paid\": 1500,\n    \"amount_remaining\": 0,\n    \"amount_shipping\": 0,\n    \"application\": null,\n    \"attempt_count\": 0,\n    \"attempted\": true,\n    \"auto_advance\": false,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null,\n"}
[2025-05-12 08:23:49] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Invoice DTO mapeado. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","invoice_id":"in_1RNreIP71JLI6sb9iurajFt1","subscription_id":"sub_1RNreIP71JLI6sb9RTCameZY","amount_paid":1500}
[2025-05-12 08:23:49] [EVENT] TransactionModelFactory: Preparando TransactionsModel desde InvoiceDTO. - Context: {"invoice_id":"in_1RNreIP71JLI6sb9iurajFt1"}
[2025-05-12 08:23:49] [EVENT] TransactionModelFactory: TransactionsModel (sin ID local aún) preparado desde InvoiceDTO. - Context: {"invoice_id":"in_1RNreIP71JLI6sb9iurajFt1"}
[2025-05-12 08:23:49] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Transacción creada para Invoice pagada. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","invoice_id":"in_1RNreIP71JLI6sb9iurajFt1","transaction_id_local":2}
[2025-05-12 08:23:49] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: latest_transaction_id actualizado en la suscripción. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","subscription_id":"sub_1RNreIP71JLI6sb9RTCameZY","latest_transaction_id":2}
[2025-05-12 08:23:49] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","invoice_id":"in_1RNreIP71JLI6sb9iurajFt1"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS","strategy_class":"App\\Strategy\\Impl\\InvoicePaidStrategyImpl"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNreKP71JLI6sb9JqDfhyWS"}
[2025-05-12 08:23:49] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:49] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:49] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:23:49] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:23:49] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:23:49] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNreKP71JLI6sb9NfS0NoLv","event_type":"invoice.payment_succeeded"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNreKP71JLI6sb9NfS0NoLv","event_type":"invoice.payment_succeeded"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNreKP71JLI6sb9NfS0NoLv","event_type":"invoice.payment_succeeded"}
[2025-05-12 08:23:49] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNreKP71JLI6sb9NfS0NoLv"}
[2025-05-12 08:23:51] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:51] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:51] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:23:51] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:23:51] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 08:23:51] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 08:23:51] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 08:23:51] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 08:29:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:29:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:29:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:29:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:29:47] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 08:29:47] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 08:29:47] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 08:29:47] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 08:29:50] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:29:50] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:29:51] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:29:51] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:29:51] [EVENT] Endpoint create_subscription_session.php: Solicitud recibida.
[2025-05-12 08:29:51] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl inicializado con appDomainBase: http://localhost:8000/public
[2025-05-12 08:29:51] [EVENT] Bootstrap: StripeCheckoutSessionService instanciado.
[2025-05-12 08:29:51] [EVENT] create_subscription_session.php: Llamando a createSubscriptionSession. - Context: {"lookup_key":"annual_payment"}
[2025-05-12 08:29:51] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Creando sesión de suscripción. - Context: {"lookup_key":"annual_payment"}
[2025-05-12 08:29:51] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Buscando Price ID. - Context: {"lookup_key":"annual_payment","context":"suscripción"}
[2025-05-12 08:29:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Price ID encontrado. - Context: {"lookup_key":"annual_payment","price_id":"price_1RLNsHP71JLI6sb9ez8HJsHt"}
[2025-05-12 08:29:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: URLs para suscripción. - Context: {"success":"http://localhost:8000/public/success.html?session_id={CHECKOUT_SESSION_ID}","cancel":"http://localhost:8000/public/cancel.html"}
[2025-05-12 08:29:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Sesión de suscripción creada. - Context: {"session_id":"cs_test_a1K29OEdatKmpfb8sELdxExqQuRMlVQSRVOTfrFCGp98S8oTRUHSPXDiQI","price_id":"price_1RLNsHP71JLI6sb9ez8HJsHt"}
[2025-05-12 08:29:52] [EVENT] create_subscription_session.php: Sesión de suscripción creada. - Context: {"session_id":"cs_test_a1K29OEdatKmpfb8sELdxExqQuRMlVQSRVOTfrFCGp98S8oTRUHSPXDiQI"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct","event_type":"charge.succeeded"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct","event_type":"charge.succeeded"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct","event_type":"charge.succeeded","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct","event_type":"charge.succeeded"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Charge DTO mapeado. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct","charge_id":"ch_3RNrkXP71JLI6sb91nnFXZqS","pi_id":"pi_3RNrkXP71JLI6sb91HEXVcW8","receipt_url":"https://pay.stripe.com/receipts/invoices/CAcaFwoVYWNjdF8xUkhKNjFQNzFKTEk2c2I5KJbjhsEGMgZEsflQAr06LBYUkqIvP7TKGyHpcvWIhTqYLbgVwmBVULpjugQpQ6EtblxdJ7ltkLiuttHe?s=ap"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: No se encontró transacción asociada al Payment Intent del Charge. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct","pi_id":"pi_3RNrkXP71JLI6sb91HEXVcW8","charge_id":"ch_3RNrkXP71JLI6sb91nnFXZqS"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct","charge_id":"ch_3RNrkXP71JLI6sb91nnFXZqS"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91VIsxxct"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkYP71JLI6sb9sfGlmact","event_type":"payment_method.attached"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkYP71JLI6sb9sfGlmact","event_type":"payment_method.attached"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNrkYP71JLI6sb9sfGlmact","event_type":"payment_method.attached"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNrkYP71JLI6sb9sfGlmact"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9KXhgvssX","event_type":"customer.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9KXhgvssX","event_type":"customer.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNrkZP71JLI6sb9KXhgvssX","event_type":"customer.created","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9KXhgvssX","event_type":"customer.created"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Customer DTO mapeado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9KXhgvssX","customer_id":"cus_SISfOyNxYKxVFI","email":"contacto@josecarlosdev.com","name":"ANUAL"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9KXhgvssX","customer_id":"cus_SISfOyNxYKxVFI"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9KXhgvssX","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9KXhgvssX"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9edR6OfhB","event_type":"customer.updated"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9edR6OfhB","event_type":"customer.updated"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNrkZP71JLI6sb9edR6OfhB","event_type":"customer.updated","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9edR6OfhB","event_type":"customer.updated"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Customer DTO mapeado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9edR6OfhB","customer_id":"cus_SISfOyNxYKxVFI","email":"contacto@josecarlosdev.com","name":"ANUAL"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9edR6OfhB","customer_id":"cus_SISfOyNxYKxVFI"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9edR6OfhB","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9edR6OfhB"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9UViGyVWk","event_type":"checkout.session.completed"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9UViGyVWk","event_type":"checkout.session.completed"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNrkZP71JLI6sb9UViGyVWk","event_type":"checkout.session.completed","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9UViGyVWk","event_type":"checkout.session.completed"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: DTO CheckoutSession mapeado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9UViGyVWk","cs_id":"cs_test_a1K29OEdatKmpfb8sELdxExqQuRMlVQSRVOTfrFCGp98S8oTRUHSPXDiQI","mode":"subscription","customer_id_stripe":"cus_SISfOyNxYKxVFI","customer_email":"contacto@josecarlosdev.com","payment_intent_id":null,"subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Suscripción de Checkout aún no en BD (se esperará a customer.subscription.created). - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8","email_from_cs":"contacto@josecarlosdev.com"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9UViGyVWk","cs_id":"cs_test_a1K29OEdatKmpfb8sELdxExqQuRMlVQSRVOTfrFCGp98S8oTRUHSPXDiQI"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9UViGyVWk","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9UViGyVWk"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw","event_type":"customer.subscription.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw","event_type":"customer.subscription.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw","event_type":"customer.subscription.created","strategy_class":"App\\Strategy\\Impl\\SubscriptionCreatedStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw","event_type":"customer.subscription.created"}
[2025-05-12 08:30:15] [EVENT] SubscriptionMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Subscription","json_representation_snippet":"{\n    \"id\": \"sub_1RNrkYP71JLI6sb9biepRIx8\",\n    \"object\": \"subscription\",\n    \"application\": null,\n    \"application_fee_percent\": null,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null\n    },\n    \"billing_cycle_anchor\": 1747038612,\n    \"billing_cycle_anchor_config\": null,\n    \"cancel_at\": null,\n    \"cancel_at_period_end\": false,\n    \"canceled_at\": null,\n    \"cancellation_details\": {\n        \"comment\": null,\n        \"feedback\": null,\n        \"reason\": null\n    },\n    \"collection_method\": \"charge_automatically\",\n    \"created\": 1747038612,\n    \"currency\": \"eur\",\n    \"customer\": \"cus_SISfOyNxYKxVFI\",\n    \"days_until_due\": null,\n    \"default_payment_method\": \"pm_1RNrkWP71JLI6sb9V9ZZF2Bf\",\n    \"default_source\": null,\n    \"default_tax_rates\": [],\n    \"description\": null,\n    \"discounts\": [],\n    \"ended_at\": null,\n    \"invoice_settings\": {\n        \"account_tax_ids\": null,\n        \"issuer\": {\n            \"type\": \"self\"\n        }\n    },\n"}
[2025-05-12 08:30:15] [EVENT] SubscriptionMapper: Usando 'start_date' como 'current_period_start'. - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 08:30:15] [EVENT] SubscriptionMapper: Usando 'items.data[0].current_period_end'. - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Subscription DTO mapeado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw","sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8","customer_id":"cus_SISfOyNxYKxVFI","status":"active"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Intentando obtener Customer para email. - Context: {"customer_id":"cus_SISfOyNxYKxVFI"}
[2025-05-12 08:30:15] [EVENT] SubscriptionModelFactory: Creando SubscriptionsModel desde SubscriptionDTO. - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 08:30:15] [EVENT] SubscriptionModelFactory: SubscriptionsModel creado exitosamente. - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Nueva suscripción creada y guardada. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw","sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw","sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw","strategy_class":"App\\Strategy\\Impl\\SubscriptionCreatedStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9Uk4JCiEw"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91y30q4Df","event_type":"payment_intent.succeeded"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91y30q4Df","event_type":"payment_intent.succeeded"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNrkXP71JLI6sb91y30q4Df","event_type":"payment_intent.succeeded","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91y30q4Df","event_type":"payment_intent.succeeded"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent DTO mapeado. - Context: {"pi_id":"pi_3RNrkXP71JLI6sb91HEXVcW8","description":"Subscription creation","invoice_id_in_pi_dto":null}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Descripción del PI sugiere pago de suscripción/factura. - Context: {"pi_id":"pi_3RNrkXP71JLI6sb91HEXVcW8","description":"Subscription creation"}
[2025-05-12 08:30:15] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent parece ser para una factura/suscripción (ID: N/A). No se creará una transacción 'one_time_receipt' separada. Se espera que InvoicePaidStrategy maneje la creación de la transacción para la factura. - Context: {"pi_id":"pi_3RNrkXP71JLI6sb91HEXVcW8","event_id":"evt_3RNrkXP71JLI6sb91y30q4Df"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91y30q4Df","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNrkXP71JLI6sb91y30q4Df"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNrkXP71JLI6sb916H51oDK","event_type":"payment_intent.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNrkXP71JLI6sb916H51oDK","event_type":"payment_intent.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_3RNrkXP71JLI6sb916H51oDK","event_type":"payment_intent.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_3RNrkXP71JLI6sb916H51oDK"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb935H0Yofl","event_type":"invoice.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb935H0Yofl","event_type":"invoice.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNrkZP71JLI6sb935H0Yofl","event_type":"invoice.created"}
[2025-05-12 08:30:15] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNrkZP71JLI6sb935H0Yofl"}
[2025-05-12 08:30:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:16] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:16] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:16] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:16] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9IYkanHn4","event_type":"invoice.finalized"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9IYkanHn4","event_type":"invoice.finalized"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNrkZP71JLI6sb9IYkanHn4","event_type":"invoice.finalized"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNrkZP71JLI6sb9IYkanHn4"}
[2025-05-12 08:30:16] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:16] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:16] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:16] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:16] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:16] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","event_type":"invoice.paid"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","event_type":"invoice.paid"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","event_type":"invoice.paid","strategy_class":"App\\Strategy\\Impl\\InvoicePaidStrategyImpl"}
[2025-05-12 08:30:16] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","event_type":"invoice.paid"}
[2025-05-12 08:30:16] [EVENT] InvoiceMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Invoice","json_representation_snippet":"{\n    \"id\": \"in_1RNrkYP71JLI6sb9es83cZcr\",\n    \"object\": \"invoice\",\n    \"account_country\": \"ES\",\n    \"account_name\": \"Stripe Lab App\",\n    \"account_tax_ids\": null,\n    \"amount_due\": 1500,\n    \"amount_overpaid\": 0,\n    \"amount_paid\": 1500,\n    \"amount_remaining\": 0,\n    \"amount_shipping\": 0,\n    \"application\": null,\n    \"attempt_count\": 0,\n    \"attempted\": true,\n    \"auto_advance\": false,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null,\n"}
[2025-05-12 08:30:16] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Invoice DTO mapeado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","invoice_id":"in_1RNrkYP71JLI6sb9es83cZcr","subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8","amount_paid":1500}
[2025-05-12 08:30:16] [EVENT] TransactionModelFactory: Preparando TransactionsModel desde InvoiceDTO. - Context: {"invoice_id":"in_1RNrkYP71JLI6sb9es83cZcr"}
[2025-05-12 08:30:16] [EVENT] TransactionModelFactory: TransactionsModel (sin ID local aún) preparado desde InvoiceDTO. - Context: {"invoice_id":"in_1RNrkYP71JLI6sb9es83cZcr"}
[2025-05-12 08:30:16] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Transacción creada para Invoice pagada. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","invoice_id":"in_1RNrkYP71JLI6sb9es83cZcr","transaction_id_local":1}
[2025-05-12 08:30:16] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: latest_transaction_id actualizado en la suscripción. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8","latest_transaction_id":1}
[2025-05-12 08:30:16] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","invoice_id":"in_1RNrkYP71JLI6sb9es83cZcr"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl","strategy_class":"App\\Strategy\\Impl\\InvoicePaidStrategyImpl"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9BgL5npNl"}
[2025-05-12 08:30:16] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:16] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:16] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 08:30:16] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 08:30:16] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 08:30:16] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9lCMdJh0N","event_type":"invoice.payment_succeeded"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNrkZP71JLI6sb9lCMdJh0N","event_type":"invoice.payment_succeeded"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNrkZP71JLI6sb9lCMdJh0N","event_type":"invoice.payment_succeeded"}
[2025-05-12 08:30:16] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNrkZP71JLI6sb9lCMdJh0N"}
[2025-05-12 08:30:18] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:18] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:18] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:30:18] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 08:30:18] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 08:30:18] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 08:30:18] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 08:30:18] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 08:35:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 08:35:49] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:52:46] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:52:46] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:52:49] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:52:49] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:53:09] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:53:09] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:54:04] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:54:04] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:57:08] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:57:08] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:57:11] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:57:11] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:57:16] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:57:16] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:57:19] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:57:19] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:57:19] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:57:19] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:57:19] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 10:57:19] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 10:57:19] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 10:57:19] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 10:57:23] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:57:23] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:58:08] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:58:08] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 10:59:30] [EVENT] Bootstrap: .env cargado.
[2025-05-12 10:59:30] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:00:05] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:00:05] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:02:28] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:02:28] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:02:43] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:02:43] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:23] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:23] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:23] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:23] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:23] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 11:04:23] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 11:04:23] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:04:23] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:04:24] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:24] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:24] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:24] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:24] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 11:04:24] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 11:04:24] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:04:24] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:04:32] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:32] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:39] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:39] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:39] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:39] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:39] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 11:04:39] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 11:04:39] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:04:39] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:04:54] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:54] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:04:55] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:04:55] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:07:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:07:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:08:02] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:08:02] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:08:04] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:08:04] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:10:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:10:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:10:16] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:10:16] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:10:21] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:10:21] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:10:38] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:10:38] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:12:16] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:12:16] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:12:17] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:12:17] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:14:21] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:14:21] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:14:21] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:14:21] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:14:21] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 11:14:21] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 11:14:21] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:14:21] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:14:34] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:14:34] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:14:34] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 11:14:34] [EVENT] API Invoices: Endpoint alcanzado con acción: list_customer
[2025-05-12 11:14:34] [EVENT] API Invoices: Solicitud para facturas del cliente. - Context: {"customer_id":"cus_SIRaAp9qqCpqyh","page":1,"limit":10}
[2025-05-12 11:14:34] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando facturas para cliente. - Context: {"stripe_customer_id":"cus_SIRaAp9qqCpqyh","page":1,"limit":10}
[2025-05-12 11:15:10] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:15:10] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:15:12] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:15:12] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:15:12] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:15:12] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:15:12] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 11:15:12] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 11:15:12] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:15:12] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:15:18] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:15:18] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:15:18] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 11:15:18] [EVENT] API Invoices: Endpoint alcanzado con acción: list_customer
[2025-05-12 11:15:18] [EVENT] API Invoices: Solicitud para facturas del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":10}
[2025-05-12 11:15:18] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando facturas para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":10}
[2025-05-12 11:19:17] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:19:17] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:19:18] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:19:18] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:19:19] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:19:19] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:19:22] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:19:22] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:19] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:19] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:19] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:19] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:19] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:21:19] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:21:19] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:21:19] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:21:19] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:21:26] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:26] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:26] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:26] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:26] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 11:21:26] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 11:21:26] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:21:26] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 11:21:35] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:35] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:36] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:36] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:36] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:36] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:36] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:21:36] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:21:36] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:21:36] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:21:36] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:21:42] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:42] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:42] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:21:42] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:21:42] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:21:42] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:21:42] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:21:46] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:46] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:46] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:21:46] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:21:46] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:21:46] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:21:46] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:21:54] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:54] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:54] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:21:54] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:21:54] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:21:54] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:21:54] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:21:54] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:21:54] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:23:53] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:23:53] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:23:53] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:23:53] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:23:53] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:23:53] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:23:53] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:23:53] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:23:53] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:24:33] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:24:33] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:24:33] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:24:33] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:24:33] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:24:33] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:24:33] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:24:33] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:24:33] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:25:09] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:25:09] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:25:09] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:25:09] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:25:09] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:25:09] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:25:09] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:25:10] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:25:10] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:25:10] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:25:10] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:25:10] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:25:10] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:25:10] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:25:10] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:25:10] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:25:10] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:25:10] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:25:10] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:25:10] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:34:24] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:34:24] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:34:24] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:34:24] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:34:24] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:34:24] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:34:24] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:34:24] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:34:24] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:34:37] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:34:37] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:34:37] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:34:37] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:34:37] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:34:37] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:34:37] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:34:40] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:34:40] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:34:40] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:34:40] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:34:40] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:34:40] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:34:40] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:32] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:37:32] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:37:32] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:37:32] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:37:32] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:37:32] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:32] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:34] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:37:34] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:37:34] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:37:34] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:37:34] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:37:34] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:37:34] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:37:34] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:34] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:42] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:37:42] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:37:42] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:37:42] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:37:42] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:37:42] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:42] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:43] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:37:43] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:37:43] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:37:43] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:37:43] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:37:43] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:43] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:45] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:37:45] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:37:45] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:37:45] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:37:45] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:37:45] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:37:45] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:40:26] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:40:26] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:40:26] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:40:26] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:40:26] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:40:26] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:40:26] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:42:44] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:42:44] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:42:45] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:42:45] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:42:45] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:42:45] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:42:45] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:42:45] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:42:45] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:42:51] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:42:51] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:42:51] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:42:51] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:42:51] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:42:51] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:42:51] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:43:59] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:43:59] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:43:59] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:43:59] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:43:59] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:43:59] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:43:59] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:44:02] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:44:02] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:44:02] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:44:02] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:44:02] [EVENT] API [api-manage-subscriptions.php]: Solicitud de gestión recibida. - Context: {"action":"cancel_now","subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:44:02] [EVENT] App\Service\Impl\StripeSubscriptionManagementServiceImpl: Solicitando cancelación inmediata vía API. - Context: {"subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:44:13] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:44:13] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:44:22] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:44:22] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:49:00] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:49:00] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:49:02] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:49:02] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:49:03] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:49:03] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:49:03] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:49:03] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:49:03] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:49:03] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:49:03] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:49:06] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:49:06] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:49:06] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:49:06] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:49:06] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:49:06] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:49:06] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:49:11] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:49:11] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:49:11] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:49:11] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:49:11] [EVENT] API [api-manage-subscriptions.php]: Solicitud de gestión recibida. - Context: {"action":"cancel_now","subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:49:11] [EVENT] App\Service\Impl\StripeSubscriptionManagementServiceImpl: Solicitando cancelación inmediata vía API. - Context: {"subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:50:42] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:50:42] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:54:39] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:54:39] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:54:39] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:54:39] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:54:39] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:54:39] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:54:39] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:54:39] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:54:39] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:54:44] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:54:44] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:54:45] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:54:45] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:54:45] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:54:45] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:54:45] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:54:46] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:54:46] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:54:46] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:54:46] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:54:46] [EVENT] API [api-manage-subscriptions.php]: Solicitud de gestión recibida. - Context: {"action":"cancel_now","subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:54:46] [EVENT] App\Service\Impl\StripeSubscriptionManagementServiceImpl: Solicitando cancelación inmediata vía API. - Context: {"subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:54:47] [EVENT] App\Service\Impl\StripeSubscriptionManagementServiceImpl: Suscripción cancelada inmediatamente (respuesta API). - Context: {"subscription_id":"sub_1RNrkYP71JLI6sb9biepRIx8","api_status":"canceled"}
[2025-05-12 11:54:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:54:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:54:48] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 11:54:48] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 11:54:48] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 11:54:48] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 11:54:48] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 11:54:48] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 11:54:48] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob","event_type":"customer.subscription.deleted"}
[2025-05-12 11:54:48] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob","event_type":"customer.subscription.deleted"}
[2025-05-12 11:54:48] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob","event_type":"customer.subscription.deleted","strategy_class":"App\\Strategy\\Impl\\SubscriptionDeletedStrategyImpl"}
[2025-05-12 11:54:48] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob","event_type":"customer.subscription.deleted"}
[2025-05-12 11:54:48] [EVENT] SubscriptionMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Subscription","json_representation_snippet":"{\n    \"id\": \"sub_1RNrkYP71JLI6sb9biepRIx8\",\n    \"object\": \"subscription\",\n    \"application\": null,\n    \"application_fee_percent\": null,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null\n    },\n    \"billing_cycle_anchor\": 1747038612,\n    \"billing_cycle_anchor_config\": null,\n    \"cancel_at\": null,\n    \"cancel_at_period_end\": false,\n    \"canceled_at\": 1747050887,\n    \"cancellation_details\": {\n        \"comment\": null,\n        \"feedback\": null,\n        \"reason\": \"cancellation_requested\"\n    },\n    \"collection_method\": \"charge_automatically\",\n    \"created\": 1747038612,\n    \"currency\": \"eur\",\n    \"customer\": \"cus_SISfOyNxYKxVFI\",\n    \"days_until_due\": null,\n    \"default_payment_method\": \"pm_1RNrkWP71JLI6sb9V9ZZF2Bf\",\n    \"default_source\": null,\n    \"default_tax_rates\": [],\n    \"description\": null,\n    \"discounts\": [],\n    \"ended_at\": 1747050887,\n    \"invoice_settings\": {\n        \"account_tax_ids\": null,\n        \"issuer\": {\n            "}
[2025-05-12 11:54:48] [EVENT] SubscriptionMapper: Usando 'start_date' como 'current_period_start'. - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:54:48] [EVENT] SubscriptionMapper: Usando 'items.data[0].current_period_end'. - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:54:48] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Subscription DTO mapeado para eliminación/cancelación. - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob","sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8","status_from_payload":"canceled"}
[2025-05-12 11:54:48] [EVENT] SubscriptionModelFactory: Actualizando SubscriptionsModel desde SubscriptionDTO. - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8","new_status":"canceled"}
[2025-05-12 11:54:48] [EVENT] SubscriptionModelFactory: SubscriptionsModel actualizado. - Context: {"sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:54:48] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Suscripción marcada como eliminada/cancelada y guardada. - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob","sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8","final_status":"canceled"}
[2025-05-12 11:54:48] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob","sub_id":"sub_1RNrkYP71JLI6sb9biepRIx8"}
[2025-05-12 11:54:48] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob","strategy_class":"App\\Strategy\\Impl\\SubscriptionDeletedStrategyImpl"}
[2025-05-12 11:54:48] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNuwVP71JLI6sb95I5oe9ob"}
[2025-05-12 11:54:50] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:54:50] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:54:50] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:54:50] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:54:50] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:54:50] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:54:50] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 11:54:57] [EVENT] Bootstrap: .env cargado.
[2025-05-12 11:54:57] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 11:54:57] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 11:54:57] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 11:54:57] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 11:54:57] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 11:54:57] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:25:03] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:03] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:08] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:08] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:30] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:30] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:33] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:33] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:33] [EVENT] Endpoint create_payment_session.php: Solicitud recibida.
[2025-05-12 12:25:33] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl inicializado con appDomainBase: http://localhost:8000/public
[2025-05-12 12:25:33] [EVENT] Bootstrap: StripeCheckoutSessionService instanciado.
[2025-05-12 12:25:33] [EVENT] create_payment_session.php: Llamando a createOneTimePaymentSession. - Context: {"lookup_key":"one_payment"}
[2025-05-12 12:25:33] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Creando sesión de pago único. - Context: {"lookup_key":"one_payment"}
[2025-05-12 12:25:33] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Buscando Price ID. - Context: {"lookup_key":"one_payment","context":"pago único"}
[2025-05-12 12:25:34] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Price ID encontrado. - Context: {"lookup_key":"one_payment","price_id":"price_1RLNYIP71JLI6sb99HofbYd0"}
[2025-05-12 12:25:34] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: URLs para pago único. - Context: {"success":"http://localhost:8000/public/success.html?session_id={CHECKOUT_SESSION_ID}","cancel":"http://localhost:8000/public/cancel.html"}
[2025-05-12 12:25:34] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Sesión de pago único creada. - Context: {"session_id":"cs_test_a1LYKGfqD55Sf8XHrtqQ1KLGTBen3V3qUriLVQrT6GeS6UdeSsuMASjPCS","price_id":"price_1RLNYIP71JLI6sb99HofbYd0"}
[2025-05-12 12:25:34] [EVENT] create_payment_session.php: Sesión de pago único creada. - Context: {"session_id":"cs_test_a1LYKGfqD55Sf8XHrtqQ1KLGTBen3V3qUriLVQrT6GeS6UdeSsuMASjPCS"}
[2025-05-12 12:25:54] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:54] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:54] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:25:54] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:25:54] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:25:54] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:25:54] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:25:54] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:25:54] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh","event_type":"charge.succeeded"}
[2025-05-12 12:25:54] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh","event_type":"charge.succeeded"}
[2025-05-12 12:25:54] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh","event_type":"charge.succeeded","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 12:25:54] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh","event_type":"charge.succeeded"}
[2025-05-12 12:25:54] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Charge DTO mapeado. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh","charge_id":"ch_3RNvQbP71JLI6sb90v5Y2VKT","pi_id":"pi_3RNvQbP71JLI6sb90MxifI17","receipt_url":"https://pay.stripe.com/receipts/payment/CAcaFwoVYWNjdF8xUkhKNjFQNzFKTEk2c2I5KNLRh8EGMgYOPUsHZXI6LBYNgv-cn2LOM_t2-7kgadUgyuiqc_ytcBaxb_Wh9b-XuU3PRfK37zwMfDQX"}
[2025-05-12 12:25:54] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: No se encontró transacción asociada al Payment Intent del Charge. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh","pi_id":"pi_3RNvQbP71JLI6sb90MxifI17","charge_id":"ch_3RNvQbP71JLI6sb90v5Y2VKT"}
[2025-05-12 12:25:54] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh","charge_id":"ch_3RNvQbP71JLI6sb90v5Y2VKT"}
[2025-05-12 12:25:54] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 12:25:54] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90Bs1PhSh"}
[2025-05-12 12:25:54] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:54] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:54] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:25:54] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:25:54] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:25:54] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:25:54] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:25:54] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:25:54] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90bte43gY","event_type":"payment_intent.succeeded"}
[2025-05-12 12:25:54] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90bte43gY","event_type":"payment_intent.succeeded"}
[2025-05-12 12:25:54] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNvQbP71JLI6sb90bte43gY","event_type":"payment_intent.succeeded","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 12:25:54] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90bte43gY","event_type":"payment_intent.succeeded"}
[2025-05-12 12:25:54] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent DTO mapeado. - Context: {"pi_id":"pi_3RNvQbP71JLI6sb90MxifI17","description":null,"invoice_id_in_pi_dto":null}
[2025-05-12 12:25:54] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Procesando como pago único directo. - Context: {"pi_id":"pi_3RNvQbP71JLI6sb90MxifI17"}
[2025-05-12 12:25:55] [EVENT] TransactionModelFactory: Preparando TransactionsModel desde PaymentIntentDTO. - Context: {"pi_id":"pi_3RNvQbP71JLI6sb90MxifI17"}
[2025-05-12 12:25:55] [EVENT] TransactionModelFactory: TransactionsModel (sin ID local aún) preparado desde PaymentIntentDTO. - Context: {"pi_id":"pi_3RNvQbP71JLI6sb90MxifI17"}
[2025-05-12 12:25:55] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Transacción de pago único directo creada. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90bte43gY","pi_id":"pi_3RNvQbP71JLI6sb90MxifI17","local_transaction_id":2}
[2025-05-12 12:25:55] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90bte43gY"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90bte43gY","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90bte43gY"}
[2025-05-12 12:25:55] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:55] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:55] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:25:55] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:25:55] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:25:55] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:25:55] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:25:55] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:25:55] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90xGRSWcP","event_type":"payment_intent.created"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90xGRSWcP","event_type":"payment_intent.created"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_3RNvQbP71JLI6sb90xGRSWcP","event_type":"payment_intent.created"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_3RNvQbP71JLI6sb90xGRSWcP"}
[2025-05-12 12:25:55] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:55] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:55] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:25:55] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:25:55] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:25:55] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:25:55] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:25:55] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:25:55] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvQcP71JLI6sb9bd8iSfyo","event_type":"checkout.session.completed"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvQcP71JLI6sb9bd8iSfyo","event_type":"checkout.session.completed"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvQcP71JLI6sb9bd8iSfyo","event_type":"checkout.session.completed","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 12:25:55] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvQcP71JLI6sb9bd8iSfyo","event_type":"checkout.session.completed"}
[2025-05-12 12:25:55] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: DTO CheckoutSession mapeado. - Context: {"event_id":"evt_1RNvQcP71JLI6sb9bd8iSfyo","cs_id":"cs_test_a1LYKGfqD55Sf8XHrtqQ1KLGTBen3V3qUriLVQrT6GeS6UdeSsuMASjPCS","mode":"payment","customer_id_stripe":null,"customer_email":"contacto@josecarlosdev.com","payment_intent_id":"pi_3RNvQbP71JLI6sb90MxifI17","subscription_id":null}
[2025-05-12 12:25:55] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Transacción ya existente para PI de Checkout (pago único). - Context: {"pi_id":"pi_3RNvQbP71JLI6sb90MxifI17","local_tx_id":2}
[2025-05-12 12:25:55] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvQcP71JLI6sb9bd8iSfyo","cs_id":"cs_test_a1LYKGfqD55Sf8XHrtqQ1KLGTBen3V3qUriLVQrT6GeS6UdeSsuMASjPCS"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvQcP71JLI6sb9bd8iSfyo","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 12:25:55] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvQcP71JLI6sb9bd8iSfyo"}
[2025-05-12 12:25:56] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:25:56] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:25:56] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:25:56] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:25:56] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:25:56] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:25:56] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:25:56] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:25:56] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90xZubgxL","event_type":"charge.updated"}
[2025-05-12 12:25:56] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvQbP71JLI6sb90xZubgxL","event_type":"charge.updated"}
[2025-05-12 12:25:56] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_3RNvQbP71JLI6sb90xZubgxL","event_type":"charge.updated"}
[2025-05-12 12:25:56] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_3RNvQbP71JLI6sb90xZubgxL"}
[2025-05-12 12:26:09] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:09] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:11] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:11] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:11] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:11] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:11] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 12:26:11] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 12:26:11] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:26:11] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:26:19] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:19] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:19] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:19] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:19] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:26:19] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:26:19] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:26:19] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:26:19] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:26:22] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:22] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:23] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:23] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:23] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 12:26:23] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 12:26:23] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:26:23] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:26:38] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:38] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:40] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:40] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:40] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:40] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:40] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:26:40] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:26:40] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:26:40] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:26:40] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:26:44] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:44] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:44] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:26:44] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:26:44] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:26:44] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 12:26:44] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 12:26:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:48] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:48] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:26:48] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:26:48] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:26:48] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:26:48] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:26:49] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:49] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:50] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:50] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:52] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:26:52] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:26:52] [EVENT] Endpoint create_subscription_session.php: Solicitud recibida.
[2025-05-12 12:26:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl inicializado con appDomainBase: http://localhost:8000/public
[2025-05-12 12:26:52] [EVENT] Bootstrap: StripeCheckoutSessionService instanciado.
[2025-05-12 12:26:52] [EVENT] create_subscription_session.php: Llamando a createSubscriptionSession. - Context: {"lookup_key":"annual_payment"}
[2025-05-12 12:26:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Creando sesión de suscripción. - Context: {"lookup_key":"annual_payment"}
[2025-05-12 12:26:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Buscando Price ID. - Context: {"lookup_key":"annual_payment","context":"suscripción"}
[2025-05-12 12:26:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Price ID encontrado. - Context: {"lookup_key":"annual_payment","price_id":"price_1RLNsHP71JLI6sb9ez8HJsHt"}
[2025-05-12 12:26:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: URLs para suscripción. - Context: {"success":"http://localhost:8000/public/success.html?session_id={CHECKOUT_SESSION_ID}","cancel":"http://localhost:8000/public/cancel.html"}
[2025-05-12 12:26:53] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Sesión de suscripción creada. - Context: {"session_id":"cs_test_a1mj7aDSXgFZEUvBZLSvJ7G7G3yq9qwT1p0m6hPA9GFMEPvcpCSRKezwaT","price_id":"price_1RLNsHP71JLI6sb9ez8HJsHt"}
[2025-05-12 12:26:53] [EVENT] create_subscription_session.php: Sesión de suscripción creada. - Context: {"session_id":"cs_test_a1mj7aDSXgFZEUvBZLSvJ7G7G3yq9qwT1p0m6hPA9GFMEPvcpCSRKezwaT"}
[2025-05-12 12:27:13] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:13] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6","event_type":"charge.succeeded"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6","event_type":"charge.succeeded"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6","event_type":"charge.succeeded","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6","event_type":"charge.succeeded"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Charge DTO mapeado. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6","charge_id":"ch_3RNvRqP71JLI6sb91wKICtgp","pi_id":"pi_3RNvRqP71JLI6sb91eHAJAGa","receipt_url":"https://pay.stripe.com/receipts/invoices/CAcaFwoVYWNjdF8xUkhKNjFQNzFKTEk2c2I5KKDSh8EGMgZOUKdWd1Y6LBapRuolBRgfA08e8KpABfsdPAP1fi-Sln3ai41yqxef1RqYlSYAJim_7wlV?s=ap"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: No se encontró transacción asociada al Payment Intent del Charge. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6","pi_id":"pi_3RNvRqP71JLI6sb91eHAJAGa","charge_id":"ch_3RNvRqP71JLI6sb91wKICtgp"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6","charge_id":"ch_3RNvRqP71JLI6sb91wKICtgp"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91TWGDux6"}
[2025-05-12 12:27:13] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:13] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9J4Ta6WSr","event_type":"payment_method.attached"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9J4Ta6WSr","event_type":"payment_method.attached"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNvRtP71JLI6sb9J4Ta6WSr","event_type":"payment_method.attached"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNvRtP71JLI6sb9J4Ta6WSr"}
[2025-05-12 12:27:13] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:13] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb91q79ovCp","event_type":"checkout.session.completed"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb91q79ovCp","event_type":"checkout.session.completed"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvRtP71JLI6sb91q79ovCp","event_type":"checkout.session.completed","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb91q79ovCp","event_type":"checkout.session.completed"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: DTO CheckoutSession mapeado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb91q79ovCp","cs_id":"cs_test_a1mj7aDSXgFZEUvBZLSvJ7G7G3yq9qwT1p0m6hPA9GFMEPvcpCSRKezwaT","mode":"subscription","customer_id_stripe":"cus_SIWUEA79HZF5Gx","customer_email":"testParaCapturarCliente@test.com","payment_intent_id":null,"subscription_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Suscripción de Checkout aún no en BD (se esperará a customer.subscription.created). - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH","email_from_cs":"testParaCapturarCliente@test.com"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb91q79ovCp","cs_id":"cs_test_a1mj7aDSXgFZEUvBZLSvJ7G7G3yq9qwT1p0m6hPA9GFMEPvcpCSRKezwaT"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb91q79ovCp","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb91q79ovCp"}
[2025-05-12 12:27:13] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:13] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9j5XNkTdi","event_type":"customer.created"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9j5XNkTdi","event_type":"customer.created"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvRtP71JLI6sb9j5XNkTdi","event_type":"customer.created","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9j5XNkTdi","event_type":"customer.created"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Customer DTO mapeado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9j5XNkTdi","customer_id":"cus_SIWUEA79HZF5Gx","email":"testParaCapturarCliente@test.com","name":"Jose Carlos"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9j5XNkTdi","customer_id":"cus_SIWUEA79HZF5Gx"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9j5XNkTdi","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9j5XNkTdi"}
[2025-05-12 12:27:13] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:13] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9NEMhn5KH","event_type":"customer.updated"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9NEMhn5KH","event_type":"customer.updated"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvRtP71JLI6sb9NEMhn5KH","event_type":"customer.updated","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9NEMhn5KH","event_type":"customer.updated"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Customer DTO mapeado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9NEMhn5KH","customer_id":"cus_SIWUEA79HZF5Gx","email":"testParaCapturarCliente@test.com","name":"Jose Carlos"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9NEMhn5KH","customer_id":"cus_SIWUEA79HZF5Gx"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9NEMhn5KH","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9NEMhn5KH"}
[2025-05-12 12:27:13] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:13] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:13] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:13] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:13] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i","event_type":"customer.subscription.created"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i","event_type":"customer.subscription.created"}
[2025-05-12 12:27:13] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i","event_type":"customer.subscription.created","strategy_class":"App\\Strategy\\Impl\\SubscriptionCreatedStrategyImpl"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i","event_type":"customer.subscription.created"}
[2025-05-12 12:27:13] [EVENT] SubscriptionMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Subscription","json_representation_snippet":"{\n    \"id\": \"sub_1RNvRsP71JLI6sb9FJb2TSLH\",\n    \"object\": \"subscription\",\n    \"application\": null,\n    \"application_fee_percent\": null,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null\n    },\n    \"billing_cycle_anchor\": 1747052830,\n    \"billing_cycle_anchor_config\": null,\n    \"cancel_at\": null,\n    \"cancel_at_period_end\": false,\n    \"canceled_at\": null,\n    \"cancellation_details\": {\n        \"comment\": null,\n        \"feedback\": null,\n        \"reason\": null\n    },\n    \"collection_method\": \"charge_automatically\",\n    \"created\": 1747052830,\n    \"currency\": \"eur\",\n    \"customer\": \"cus_SIWUEA79HZF5Gx\",\n    \"days_until_due\": null,\n    \"default_payment_method\": \"pm_1RNvRpP71JLI6sb9IGu1NJX7\",\n    \"default_source\": null,\n    \"default_tax_rates\": [],\n    \"description\": null,\n    \"discounts\": [],\n    \"ended_at\": null,\n    \"invoice_settings\": {\n        \"account_tax_ids\": null,\n        \"issuer\": {\n            \"type\": \"self\"\n        }\n    },\n"}
[2025-05-12 12:27:13] [EVENT] SubscriptionMapper: Usando 'start_date' como 'current_period_start'. - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:27:13] [EVENT] SubscriptionMapper: Usando 'items.data[0].current_period_end'. - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Subscription DTO mapeado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i","sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH","customer_id":"cus_SIWUEA79HZF5Gx","status":"active"}
[2025-05-12 12:27:13] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Intentando obtener Customer para email. - Context: {"customer_id":"cus_SIWUEA79HZF5Gx"}
[2025-05-12 12:27:14] [EVENT] SubscriptionModelFactory: Creando SubscriptionsModel desde SubscriptionDTO. - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:27:14] [EVENT] SubscriptionModelFactory: SubscriptionsModel creado exitosamente. - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Nueva suscripción creada y guardada. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i","sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i","sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i","strategy_class":"App\\Strategy\\Impl\\SubscriptionCreatedStrategyImpl"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9eQxyY88i"}
[2025-05-12 12:27:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91qvRLtZo","event_type":"payment_intent.succeeded"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91qvRLtZo","event_type":"payment_intent.succeeded"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNvRqP71JLI6sb91qvRLtZo","event_type":"payment_intent.succeeded","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91qvRLtZo","event_type":"payment_intent.succeeded"}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent DTO mapeado. - Context: {"pi_id":"pi_3RNvRqP71JLI6sb91eHAJAGa","description":"Subscription creation","invoice_id_in_pi_dto":null}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Descripción del PI sugiere pago de suscripción/factura. - Context: {"pi_id":"pi_3RNvRqP71JLI6sb91eHAJAGa","description":"Subscription creation"}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent parece ser para una factura/suscripción (ID: N/A). No se creará una transacción 'one_time_receipt' separada. Se espera que InvoicePaidStrategy maneje la creación de la transacción para la factura. - Context: {"pi_id":"pi_3RNvRqP71JLI6sb91eHAJAGa","event_id":"evt_3RNvRqP71JLI6sb91qvRLtZo"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91qvRLtZo","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91qvRLtZo"}
[2025-05-12 12:27:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91yTTUXee","event_type":"payment_intent.created"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvRqP71JLI6sb91yTTUXee","event_type":"payment_intent.created"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_3RNvRqP71JLI6sb91yTTUXee","event_type":"payment_intent.created"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_3RNvRqP71JLI6sb91yTTUXee"}
[2025-05-12 12:27:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9ny3ipEke","event_type":"invoice.created"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb9ny3ipEke","event_type":"invoice.created"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNvRtP71JLI6sb9ny3ipEke","event_type":"invoice.created"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNvRtP71JLI6sb9ny3ipEke"}
[2025-05-12 12:27:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb94OLRy3Xe","event_type":"invoice.finalized"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb94OLRy3Xe","event_type":"invoice.finalized"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNvRtP71JLI6sb94OLRy3Xe","event_type":"invoice.finalized"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNvRtP71JLI6sb94OLRy3Xe"}
[2025-05-12 12:27:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","event_type":"invoice.paid"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","event_type":"invoice.paid"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","event_type":"invoice.paid","strategy_class":"App\\Strategy\\Impl\\InvoicePaidStrategyImpl"}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","event_type":"invoice.paid"}
[2025-05-12 12:27:14] [EVENT] InvoiceMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Invoice","json_representation_snippet":"{\n    \"id\": \"in_1RNvRsP71JLI6sb9HuI7Pvxm\",\n    \"object\": \"invoice\",\n    \"account_country\": \"ES\",\n    \"account_name\": \"Stripe Lab App\",\n    \"account_tax_ids\": null,\n    \"amount_due\": 1500,\n    \"amount_overpaid\": 0,\n    \"amount_paid\": 1500,\n    \"amount_remaining\": 0,\n    \"amount_shipping\": 0,\n    \"application\": null,\n    \"attempt_count\": 0,\n    \"attempted\": true,\n    \"auto_advance\": false,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null,\n"}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Invoice DTO mapeado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","invoice_id":"in_1RNvRsP71JLI6sb9HuI7Pvxm","subscription_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH","amount_paid":1500}
[2025-05-12 12:27:14] [EVENT] TransactionModelFactory: Preparando TransactionsModel desde InvoiceDTO. - Context: {"invoice_id":"in_1RNvRsP71JLI6sb9HuI7Pvxm"}
[2025-05-12 12:27:14] [EVENT] TransactionModelFactory: TransactionsModel (sin ID local aún) preparado desde InvoiceDTO. - Context: {"invoice_id":"in_1RNvRsP71JLI6sb9HuI7Pvxm"}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Transacción creada para Invoice pagada. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","invoice_id":"in_1RNvRsP71JLI6sb9HuI7Pvxm","transaction_id_local":3}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: latest_transaction_id actualizado en la suscripción. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","subscription_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH","latest_transaction_id":3}
[2025-05-12 12:27:14] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","invoice_id":"in_1RNvRsP71JLI6sb9HuI7Pvxm"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi","strategy_class":"App\\Strategy\\Impl\\InvoicePaidStrategyImpl"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvRtP71JLI6sb99f9Kq6vi"}
[2025-05-12 12:27:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:27:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:27:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvRtP71JLI6sb913y1pY9V","event_type":"invoice.payment_succeeded"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvRtP71JLI6sb913y1pY9V","event_type":"invoice.payment_succeeded"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNvRtP71JLI6sb913y1pY9V","event_type":"invoice.payment_succeeded"}
[2025-05-12 12:27:14] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNvRtP71JLI6sb913y1pY9V"}
[2025-05-12 12:27:17] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:17] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:17] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:17] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:17] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 12:27:17] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 12:27:17] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:27:17] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:27:43] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:43] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:44] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:44] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:44] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:27:44] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:27:44] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:27:44] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:27:44] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:27:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:27:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:27:47] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:27:47] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:27:47] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:27:47] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 12:27:47] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SISfOyNxYKxVFI","page":1,"limit":5}
[2025-05-12 12:28:04] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:04] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:06] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:06] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:06] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:06] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:06] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:28:06] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:28:06] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:28:06] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:28:06] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:28:18] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:18] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:26] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:26] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:27] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:27] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:27] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:28:27] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:28:27] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:28:27] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:28:27] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:28:31] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:31] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:31] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:28:31] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:28:31] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:28:31] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SIWUEA79HZF5Gx","page":1,"limit":5}
[2025-05-12 12:28:31] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SIWUEA79HZF5Gx","page":1,"limit":5}
[2025-05-12 12:28:47] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:47] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:47] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:28:47] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:28:47] [EVENT] API [api-manage-subscriptions.php]: Solicitud de gestión recibida. - Context: {"action":"cancel_now","subscription_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:28:47] [EVENT] App\Service\Impl\StripeSubscriptionManagementServiceImpl: Solicitando cancelación inmediata vía API. - Context: {"subscription_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:28:48] [EVENT] App\Service\Impl\StripeSubscriptionManagementServiceImpl: Suscripción cancelada inmediatamente (respuesta API). - Context: {"subscription_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH","api_status":"canceled"}
[2025-05-12 12:28:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:48] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:48] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:28:48] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:28:48] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:28:48] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:28:48] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:28:48] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:28:48] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V","event_type":"customer.subscription.deleted"}
[2025-05-12 12:28:48] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V","event_type":"customer.subscription.deleted"}
[2025-05-12 12:28:48] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V","event_type":"customer.subscription.deleted","strategy_class":"App\\Strategy\\Impl\\SubscriptionDeletedStrategyImpl"}
[2025-05-12 12:28:48] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V","event_type":"customer.subscription.deleted"}
[2025-05-12 12:28:48] [EVENT] SubscriptionMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Subscription","json_representation_snippet":"{\n    \"id\": \"sub_1RNvRsP71JLI6sb9FJb2TSLH\",\n    \"object\": \"subscription\",\n    \"application\": null,\n    \"application_fee_percent\": null,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null\n    },\n    \"billing_cycle_anchor\": 1747052830,\n    \"billing_cycle_anchor_config\": null,\n    \"cancel_at\": null,\n    \"cancel_at_period_end\": false,\n    \"canceled_at\": 1747052927,\n    \"cancellation_details\": {\n        \"comment\": null,\n        \"feedback\": null,\n        \"reason\": \"cancellation_requested\"\n    },\n    \"collection_method\": \"charge_automatically\",\n    \"created\": 1747052830,\n    \"currency\": \"eur\",\n    \"customer\": \"cus_SIWUEA79HZF5Gx\",\n    \"days_until_due\": null,\n    \"default_payment_method\": \"pm_1RNvRpP71JLI6sb9IGu1NJX7\",\n    \"default_source\": null,\n    \"default_tax_rates\": [],\n    \"description\": null,\n    \"discounts\": [],\n    \"ended_at\": 1747052927,\n    \"invoice_settings\": {\n        \"account_tax_ids\": null,\n        \"issuer\": {\n            "}
[2025-05-12 12:28:48] [EVENT] SubscriptionMapper: Usando 'start_date' como 'current_period_start'. - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:28:48] [EVENT] SubscriptionMapper: Usando 'items.data[0].current_period_end'. - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:28:48] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Subscription DTO mapeado para eliminación/cancelación. - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V","sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH","status_from_payload":"canceled"}
[2025-05-12 12:28:48] [EVENT] SubscriptionModelFactory: Actualizando SubscriptionsModel desde SubscriptionDTO. - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH","new_status":"canceled"}
[2025-05-12 12:28:48] [EVENT] SubscriptionModelFactory: SubscriptionsModel actualizado. - Context: {"sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:28:48] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Suscripción marcada como eliminada/cancelada y guardada. - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V","sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH","final_status":"canceled"}
[2025-05-12 12:28:48] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V","sub_id":"sub_1RNvRsP71JLI6sb9FJb2TSLH"}
[2025-05-12 12:28:48] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V","strategy_class":"App\\Strategy\\Impl\\SubscriptionDeletedStrategyImpl"}
[2025-05-12 12:28:48] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvTQP71JLI6sb9orMoGB8V"}
[2025-05-12 12:28:50] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:28:50] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:28:50] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:28:50] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:28:50] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:28:50] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SIWUEA79HZF5Gx","page":1,"limit":5}
[2025-05-12 12:28:50] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SIWUEA79HZF5Gx","page":1,"limit":5}
[2025-05-12 12:29:06] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:29:06] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:30:57] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:30:57] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:30:57] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:30:57] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:30:57] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:30:57] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:30:57] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:41:09] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:09] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:10] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:10] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:13] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:13] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:13] [EVENT] Endpoint create_payment_session.php: Solicitud recibida.
[2025-05-12 12:41:13] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl inicializado con appDomainBase: http://localhost:8000/public
[2025-05-12 12:41:13] [EVENT] Bootstrap: StripeCheckoutSessionService instanciado.
[2025-05-12 12:41:13] [EVENT] create_payment_session.php: Llamando a createOneTimePaymentSession. - Context: {"lookup_key":"one_payment"}
[2025-05-12 12:41:13] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Creando sesión de pago único. - Context: {"lookup_key":"one_payment"}
[2025-05-12 12:41:13] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Buscando Price ID. - Context: {"lookup_key":"one_payment","context":"pago único"}
[2025-05-12 12:41:13] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Price ID encontrado. - Context: {"lookup_key":"one_payment","price_id":"price_1RLNYIP71JLI6sb99HofbYd0"}
[2025-05-12 12:41:13] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: URLs para pago único. - Context: {"success":"http://localhost:8000/public/success.html?session_id={CHECKOUT_SESSION_ID}","cancel":"http://localhost:8000/public/cancel.html"}
[2025-05-12 12:41:14] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Sesión de pago único creada. - Context: {"session_id":"cs_test_a1VNRkttBpHSlQUlpDECWDk9MVUUYTumhbzqxg1T1kpueYmze2Vd8xWQn2","price_id":"price_1RLNYIP71JLI6sb99HofbYd0"}
[2025-05-12 12:41:14] [EVENT] create_payment_session.php: Sesión de pago único creada. - Context: {"session_id":"cs_test_a1VNRkttBpHSlQUlpDECWDk9MVUUYTumhbzqxg1T1kpueYmze2Vd8xWQn2"}
[2025-05-12 12:41:34] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:34] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:34] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:41:34] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:41:34] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:41:34] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go","event_type":"charge.succeeded"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go","event_type":"charge.succeeded"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go","event_type":"charge.succeeded","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go","event_type":"charge.succeeded"}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Charge DTO mapeado. - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go","charge_id":"ch_3RNvflP71JLI6sb90vUqQ48Z","pi_id":"pi_3RNvflP71JLI6sb90NqqZg0S","receipt_url":"https://pay.stripe.com/receipts/payment/CAcaFwoVYWNjdF8xUkhKNjFQNzFKTEk2c2I5KP7Yh8EGMgYajwzMyhk6LBboEcvYSo1jFNMdYl8Tq70n_IN1U4rLKJ--Nkmp_q6zvMemwScJlc90Mnd8"}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: No se encontró transacción asociada al Payment Intent del Charge. - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go","pi_id":"pi_3RNvflP71JLI6sb90NqqZg0S","charge_id":"ch_3RNvflP71JLI6sb90vUqQ48Z"}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go","charge_id":"ch_3RNvflP71JLI6sb90vUqQ48Z"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNvflP71JLI6sb90Ukfp9go"}
[2025-05-12 12:41:34] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:34] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:34] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:41:34] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:41:34] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:41:34] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvflP71JLI6sb907lR4VlR","event_type":"payment_intent.succeeded"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvflP71JLI6sb907lR4VlR","event_type":"payment_intent.succeeded"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNvflP71JLI6sb907lR4VlR","event_type":"payment_intent.succeeded","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNvflP71JLI6sb907lR4VlR","event_type":"payment_intent.succeeded"}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent DTO mapeado. - Context: {"pi_id":"pi_3RNvflP71JLI6sb90NqqZg0S","description":null,"invoice_id_in_pi_dto":null}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Procesando como pago único directo. - Context: {"pi_id":"pi_3RNvflP71JLI6sb90NqqZg0S"}
[2025-05-12 12:41:34] [EVENT] TransactionModelFactory: Preparando TransactionsModel desde PaymentIntentDTO. - Context: {"pi_id":"pi_3RNvflP71JLI6sb90NqqZg0S"}
[2025-05-12 12:41:34] [EVENT] TransactionModelFactory: TransactionsModel (sin ID local aún) preparado desde PaymentIntentDTO. - Context: {"pi_id":"pi_3RNvflP71JLI6sb90NqqZg0S"}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Transacción de pago único directo creada. - Context: {"event_id":"evt_3RNvflP71JLI6sb907lR4VlR","pi_id":"pi_3RNvflP71JLI6sb90NqqZg0S","local_transaction_id":4}
[2025-05-12 12:41:34] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNvflP71JLI6sb907lR4VlR"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNvflP71JLI6sb907lR4VlR","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNvflP71JLI6sb907lR4VlR"}
[2025-05-12 12:41:34] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:34] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:34] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:41:34] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:41:34] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:41:34] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvflP71JLI6sb90dBf70VL","event_type":"payment_intent.created"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvflP71JLI6sb90dBf70VL","event_type":"payment_intent.created"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_3RNvflP71JLI6sb90dBf70VL","event_type":"payment_intent.created"}
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_3RNvflP71JLI6sb90dBf70VL"}
[2025-05-12 12:41:34] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:34] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:34] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:41:34] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:41:34] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:41:34] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:41:34] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:41:34] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:41:35] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvfmP71JLI6sb9T64PU8TC","event_type":"checkout.session.completed"}
[2025-05-12 12:41:35] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvfmP71JLI6sb9T64PU8TC","event_type":"checkout.session.completed"}
[2025-05-12 12:41:35] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvfmP71JLI6sb9T64PU8TC","event_type":"checkout.session.completed","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 12:41:35] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvfmP71JLI6sb9T64PU8TC","event_type":"checkout.session.completed"}
[2025-05-12 12:41:35] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: DTO CheckoutSession mapeado. - Context: {"event_id":"evt_1RNvfmP71JLI6sb9T64PU8TC","cs_id":"cs_test_a1VNRkttBpHSlQUlpDECWDk9MVUUYTumhbzqxg1T1kpueYmze2Vd8xWQn2","mode":"payment","customer_id_stripe":null,"customer_email":"contacto@josecarlosdev.com","payment_intent_id":"pi_3RNvflP71JLI6sb90NqqZg0S","subscription_id":null}
[2025-05-12 12:41:35] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Transacción ya existente para PI de Checkout (pago único). - Context: {"pi_id":"pi_3RNvflP71JLI6sb90NqqZg0S","local_tx_id":4}
[2025-05-12 12:41:35] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvfmP71JLI6sb9T64PU8TC","cs_id":"cs_test_a1VNRkttBpHSlQUlpDECWDk9MVUUYTumhbzqxg1T1kpueYmze2Vd8xWQn2"}
[2025-05-12 12:41:35] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvfmP71JLI6sb9T64PU8TC","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 12:41:35] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvfmP71JLI6sb9T64PU8TC"}
[2025-05-12 12:41:36] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:36] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:36] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:41:36] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:41:36] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:41:36] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:41:36] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:41:36] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:41:36] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvflP71JLI6sb90CZ04AYr","event_type":"charge.updated"}
[2025-05-12 12:41:36] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvflP71JLI6sb90CZ04AYr","event_type":"charge.updated"}
[2025-05-12 12:41:36] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_3RNvflP71JLI6sb90CZ04AYr","event_type":"charge.updated"}
[2025-05-12 12:41:36] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_3RNvflP71JLI6sb90CZ04AYr"}
[2025-05-12 12:41:39] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:39] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:39] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:39] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:39] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 12:41:39] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 12:41:39] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:41:39] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:41:50] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:50] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:51] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:41:51] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:41:51] [EVENT] Endpoint create_subscription_session.php: Solicitud recibida.
[2025-05-12 12:41:51] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl inicializado con appDomainBase: http://localhost:8000/public
[2025-05-12 12:41:51] [EVENT] Bootstrap: StripeCheckoutSessionService instanciado.
[2025-05-12 12:41:51] [EVENT] create_subscription_session.php: Llamando a createSubscriptionSession. - Context: {"lookup_key":"annual_payment"}
[2025-05-12 12:41:51] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Creando sesión de suscripción. - Context: {"lookup_key":"annual_payment"}
[2025-05-12 12:41:51] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Buscando Price ID. - Context: {"lookup_key":"annual_payment","context":"suscripción"}
[2025-05-12 12:41:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Price ID encontrado. - Context: {"lookup_key":"annual_payment","price_id":"price_1RLNsHP71JLI6sb9ez8HJsHt"}
[2025-05-12 12:41:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: URLs para suscripción. - Context: {"success":"http://localhost:8000/public/success.html?session_id={CHECKOUT_SESSION_ID}","cancel":"http://localhost:8000/public/cancel.html"}
[2025-05-12 12:41:52] [EVENT] App\Service\Impl\StripeCheckoutSessionServiceImpl: Sesión de suscripción creada. - Context: {"session_id":"cs_test_a1JbL0jNuBqUuh1iykaV2LRkWyAs0PFHFJviFOvkDI9MHPdVDFWRIgOSnZ","price_id":"price_1RLNsHP71JLI6sb9ez8HJsHt"}
[2025-05-12 12:41:52] [EVENT] create_subscription_session.php: Sesión de suscripción creada. - Context: {"session_id":"cs_test_a1JbL0jNuBqUuh1iykaV2LRkWyAs0PFHFJviFOvkDI9MHPdVDFWRIgOSnZ"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5","event_type":"charge.succeeded"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5","event_type":"charge.succeeded"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5","event_type":"charge.succeeded","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5","event_type":"charge.succeeded"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Charge DTO mapeado. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5","charge_id":"ch_3RNvgNP71JLI6sb91FwTH2eD","pi_id":"pi_3RNvgNP71JLI6sb91elEvsvj","receipt_url":"https://pay.stripe.com/receipts/invoices/CAcaFwoVYWNjdF8xUkhKNjFQNzFKTEk2c2I5KKXZh8EGMgZV9xNSjls6LBZmfznNJtVW-hH-ngKudBxput2InoqWsEnB1UgkHqqy11oN2l4uK_Hh7YBg?s=ap"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: No se encontró transacción asociada al Payment Intent del Charge. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5","pi_id":"pi_3RNvgNP71JLI6sb91elEvsvj","charge_id":"ch_3RNvgNP71JLI6sb91FwTH2eD"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\ChargeSucceededStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5","charge_id":"ch_3RNvgNP71JLI6sb91FwTH2eD"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5","strategy_class":"App\\Strategy\\Impl\\ChargeSucceededStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91gB46rw5"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9U2QfgQ3S","event_type":"payment_method.attached"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9U2QfgQ3S","event_type":"payment_method.attached"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNvgPP71JLI6sb9U2QfgQ3S","event_type":"payment_method.attached"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNvgPP71JLI6sb9U2QfgQ3S"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9GMqxkezx","event_type":"checkout.session.completed"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9GMqxkezx","event_type":"checkout.session.completed"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvgPP71JLI6sb9GMqxkezx","event_type":"checkout.session.completed","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9GMqxkezx","event_type":"checkout.session.completed"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: DTO CheckoutSession mapeado. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9GMqxkezx","cs_id":"cs_test_a1JbL0jNuBqUuh1iykaV2LRkWyAs0PFHFJviFOvkDI9MHPdVDFWRIgOSnZ","mode":"subscription","customer_id_stripe":"cus_SIWj6O1s3AdCZp","customer_email":"testParaCapturarCliente@test.com","payment_intent_id":null,"subscription_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Suscripción de Checkout aún no en BD (se esperará a customer.subscription.created). - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg","email_from_cs":"testParaCapturarCliente@test.com"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CheckoutSessionCompletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9GMqxkezx","cs_id":"cs_test_a1JbL0jNuBqUuh1iykaV2LRkWyAs0PFHFJviFOvkDI9MHPdVDFWRIgOSnZ"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9GMqxkezx","strategy_class":"App\\Strategy\\Impl\\CheckoutSessionCompletedStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvgPP71JLI6sb9GMqxkezx"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9QUZ89sHc","event_type":"customer.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9QUZ89sHc","event_type":"customer.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvgQP71JLI6sb9QUZ89sHc","event_type":"customer.created","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9QUZ89sHc","event_type":"customer.created"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Customer DTO mapeado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9QUZ89sHc","customer_id":"cus_SIWj6O1s3AdCZp","email":"testParaCapturarCliente@test.com","name":"cliente anual"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9QUZ89sHc","customer_id":"cus_SIWj6O1s3AdCZp"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9QUZ89sHc","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9QUZ89sHc"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9B8HiF1Dc","event_type":"customer.updated"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9B8HiF1Dc","event_type":"customer.updated"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvgQP71JLI6sb9B8HiF1Dc","event_type":"customer.updated","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9B8HiF1Dc","event_type":"customer.updated"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Customer DTO mapeado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9B8HiF1Dc","customer_id":"cus_SIWj6O1s3AdCZp","email":"testParaCapturarCliente@test.com","name":"cliente anual"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\CustomerCreatedOrUpdatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9B8HiF1Dc","customer_id":"cus_SIWj6O1s3AdCZp"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9B8HiF1Dc","strategy_class":"App\\Strategy\\Impl\\CustomerCreatedOrUpdatedStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9B8HiF1Dc"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb","event_type":"customer.subscription.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb","event_type":"customer.subscription.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb","event_type":"customer.subscription.created","strategy_class":"App\\Strategy\\Impl\\SubscriptionCreatedStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb","event_type":"customer.subscription.created"}
[2025-05-12 12:42:14] [EVENT] SubscriptionMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Subscription","json_representation_snippet":"{\n    \"id\": \"sub_1RNvgPP71JLI6sb9xZKJnhLg\",\n    \"object\": \"subscription\",\n    \"application\": null,\n    \"application_fee_percent\": null,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null\n    },\n    \"billing_cycle_anchor\": 1747053731,\n    \"billing_cycle_anchor_config\": null,\n    \"cancel_at\": null,\n    \"cancel_at_period_end\": false,\n    \"canceled_at\": null,\n    \"cancellation_details\": {\n        \"comment\": null,\n        \"feedback\": null,\n        \"reason\": null\n    },\n    \"collection_method\": \"charge_automatically\",\n    \"created\": 1747053731,\n    \"currency\": \"eur\",\n    \"customer\": \"cus_SIWj6O1s3AdCZp\",\n    \"days_until_due\": null,\n    \"default_payment_method\": \"pm_1RNvgNP71JLI6sb9kNKVMddk\",\n    \"default_source\": null,\n    \"default_tax_rates\": [],\n    \"description\": null,\n    \"discounts\": [],\n    \"ended_at\": null,\n    \"invoice_settings\": {\n        \"account_tax_ids\": null,\n        \"issuer\": {\n            \"type\": \"self\"\n        }\n    },\n"}
[2025-05-12 12:42:14] [EVENT] SubscriptionMapper: Usando 'start_date' como 'current_period_start'. - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:14] [EVENT] SubscriptionMapper: Usando 'items.data[0].current_period_end'. - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Subscription DTO mapeado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb","sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg","customer_id":"cus_SIWj6O1s3AdCZp","status":"active"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Intentando obtener Customer para email. - Context: {"customer_id":"cus_SIWj6O1s3AdCZp"}
[2025-05-12 12:42:14] [EVENT] SubscriptionModelFactory: Creando SubscriptionsModel desde SubscriptionDTO. - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:14] [EVENT] SubscriptionModelFactory: SubscriptionsModel creado exitosamente. - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Nueva suscripción creada y guardada. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb","sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\SubscriptionCreatedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb","sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb","strategy_class":"App\\Strategy\\Impl\\SubscriptionCreatedStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9Y1Nz8MLb"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91RCZw47X","event_type":"payment_intent.succeeded"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91RCZw47X","event_type":"payment_intent.succeeded"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_3RNvgNP71JLI6sb91RCZw47X","event_type":"payment_intent.succeeded","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91RCZw47X","event_type":"payment_intent.succeeded"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent DTO mapeado. - Context: {"pi_id":"pi_3RNvgNP71JLI6sb91elEvsvj","description":"Subscription creation","invoice_id_in_pi_dto":null}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: Descripción del PI sugiere pago de suscripción/factura. - Context: {"pi_id":"pi_3RNvgNP71JLI6sb91elEvsvj","description":"Subscription creation"}
[2025-05-12 12:42:14] [EVENT] App\Strategy\Impl\PaymentIntentSucceededStrategyImpl: PaymentIntent parece ser para una factura/suscripción (ID: N/A). No se creará una transacción 'one_time_receipt' separada. Se espera que InvoicePaidStrategy maneje la creación de la transacción para la factura. - Context: {"pi_id":"pi_3RNvgNP71JLI6sb91elEvsvj","event_id":"evt_3RNvgNP71JLI6sb91RCZw47X"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91RCZw47X","strategy_class":"App\\Strategy\\Impl\\PaymentIntentSucceededStrategyImpl"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91RCZw47X"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91YIHjwN6","event_type":"payment_intent.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_3RNvgNP71JLI6sb91YIHjwN6","event_type":"payment_intent.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_3RNvgNP71JLI6sb91YIHjwN6","event_type":"payment_intent.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_3RNvgNP71JLI6sb91YIHjwN6"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:14] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9JquizRgd","event_type":"invoice.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9JquizRgd","event_type":"invoice.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNvgQP71JLI6sb9JquizRgd","event_type":"invoice.created"}
[2025-05-12 12:42:14] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNvgQP71JLI6sb9JquizRgd"}
[2025-05-12 12:42:14] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:14] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9jNUBUlvs","event_type":"invoice.finalized"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9jNUBUlvs","event_type":"invoice.finalized"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNvgQP71JLI6sb9jNUBUlvs","event_type":"invoice.finalized"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNvgQP71JLI6sb9jNUBUlvs"}
[2025-05-12 12:42:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","event_type":"invoice.paid"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","event_type":"invoice.paid"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","event_type":"invoice.paid","strategy_class":"App\\Strategy\\Impl\\InvoicePaidStrategyImpl"}
[2025-05-12 12:42:15] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","event_type":"invoice.paid"}
[2025-05-12 12:42:15] [EVENT] InvoiceMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Invoice","json_representation_snippet":"{\n    \"id\": \"in_1RNvgPP71JLI6sb9lq9nGbL0\",\n    \"object\": \"invoice\",\n    \"account_country\": \"ES\",\n    \"account_name\": \"Stripe Lab App\",\n    \"account_tax_ids\": null,\n    \"amount_due\": 1500,\n    \"amount_overpaid\": 0,\n    \"amount_paid\": 1500,\n    \"amount_remaining\": 0,\n    \"amount_shipping\": 0,\n    \"application\": null,\n    \"attempt_count\": 0,\n    \"attempted\": true,\n    \"auto_advance\": false,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null,\n"}
[2025-05-12 12:42:15] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Invoice DTO mapeado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","invoice_id":"in_1RNvgPP71JLI6sb9lq9nGbL0","subscription_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg","amount_paid":1500}
[2025-05-12 12:42:15] [EVENT] TransactionModelFactory: Preparando TransactionsModel desde InvoiceDTO. - Context: {"invoice_id":"in_1RNvgPP71JLI6sb9lq9nGbL0"}
[2025-05-12 12:42:15] [EVENT] TransactionModelFactory: TransactionsModel (sin ID local aún) preparado desde InvoiceDTO. - Context: {"invoice_id":"in_1RNvgPP71JLI6sb9lq9nGbL0"}
[2025-05-12 12:42:15] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Transacción creada para Invoice pagada. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","invoice_id":"in_1RNvgPP71JLI6sb9lq9nGbL0","transaction_id_local":5}
[2025-05-12 12:42:15] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: latest_transaction_id actualizado en la suscripción. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","subscription_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg","latest_transaction_id":5}
[2025-05-12 12:42:15] [EVENT] App\Strategy\Impl\InvoicePaidStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","invoice_id":"in_1RNvgPP71JLI6sb9lq9nGbL0"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9","strategy_class":"App\\Strategy\\Impl\\InvoicePaidStrategyImpl"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9KyR4gzz9"}
[2025-05-12 12:42:15] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:15] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:15] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:15] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:15] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:15] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9wKqgrd3h","event_type":"invoice.payment_succeeded"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvgQP71JLI6sb9wKqgrd3h","event_type":"invoice.payment_succeeded"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookService: No se encontró estrategia aplicable (payload logueado en unhandled_stripe_events.log). - Context: {"event_id":"evt_1RNvgQP71JLI6sb9wKqgrd3h","event_type":"invoice.payment_succeeded"}
[2025-05-12 12:42:15] [EVENT] StripeWebhookController: No se encontró estrategia aplicable. - Context: {"event_type":null,"event_id":"evt_1RNvgQP71JLI6sb9wKqgrd3h"}
[2025-05-12 12:42:17] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:17] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:17] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:17] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:17] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 12:42:17] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 12:42:17] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:42:17] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:42:25] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:25] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:26] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:26] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:26] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:42:26] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:42:26] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:42:26] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:42:26] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:42:29] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:29] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:29] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:29] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:29] [EVENT] Bootstrap: StripeInvoiceController instanciado.
[2025-05-12 12:42:29] [EVENT] API Invoices: Endpoint alcanzado con acción: list_all
[2025-05-12 12:42:29] [EVENT] API Invoices: Solicitud para listar todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:42:29] [EVENT] App\Controller\Impl\StripeInvoiceControllerImpl: Solicitando todas las facturas. - Context: {"page":1,"limit":10}
[2025-05-12 12:42:48] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:48] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:49] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:49] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:49] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:49] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:49] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:42:49] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:42:49] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:42:49] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:42:49] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_xxxxxxxxxxxxxx","page":1,"limit":5}
[2025-05-12 12:42:52] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:52] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:52] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:42:52] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:42:52] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:42:52] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SIWj6O1s3AdCZp","page":1,"limit":5}
[2025-05-12 12:42:52] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SIWj6O1s3AdCZp","page":1,"limit":5}
[2025-05-12 12:42:56] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:56] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:56] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:42:56] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:42:56] [EVENT] API [api-manage-subscriptions.php]: Solicitud de gestión recibida. - Context: {"action":"cancel_now","subscription_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:56] [EVENT] App\Service\Impl\StripeSubscriptionManagementServiceImpl: Solicitando cancelación inmediata vía API. - Context: {"subscription_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:57] [EVENT] App\Service\Impl\StripeSubscriptionManagementServiceImpl: Suscripción cancelada inmediatamente (respuesta API). - Context: {"subscription_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg","api_status":"canceled"}
[2025-05-12 12:42:57] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:42:57] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:42:57] [EVENT] Bootstrap: Todas las estrategias (8) instanciadas.
[2025-05-12 12:42:57] [EVENT] StripeWebhookServiceImpl inicializado con 8 estrategias.
[2025-05-12 12:42:57] [EVENT] Bootstrap: StripeWebhookService instanciado.
[2025-05-12 12:42:57] [EVENT] Bootstrap: StripeWebhookController instanciado.
[2025-05-12 12:42:57] [EVENT] StripeWebhookController: Webhook recibido.
[2025-05-12 12:42:57] [EVENT] StripeWebhookService: Intentando construir evento de Stripe.
[2025-05-12 12:42:57] [EVENT] StripeWebhookController: Evento de Stripe construido y verificado. - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d","event_type":"customer.subscription.deleted"}
[2025-05-12 12:42:57] [EVENT] StripeWebhookService: Buscando estrategia para procesar evento. - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d","event_type":"customer.subscription.deleted"}
[2025-05-12 12:42:57] [EVENT] StripeWebhookService: Estrategia encontrada, procesando... - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d","event_type":"customer.subscription.deleted","strategy_class":"App\\Strategy\\Impl\\SubscriptionDeletedStrategyImpl"}
[2025-05-12 12:42:57] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Iniciando procesamiento. - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d","event_type":"customer.subscription.deleted"}
[2025-05-12 12:42:57] [EVENT] SubscriptionMapper DEBUG: Objeto payload recibido. - Context: {"class":"Stripe\\Subscription","json_representation_snippet":"{\n    \"id\": \"sub_1RNvgPP71JLI6sb9xZKJnhLg\",\n    \"object\": \"subscription\",\n    \"application\": null,\n    \"application_fee_percent\": null,\n    \"automatic_tax\": {\n        \"disabled_reason\": null,\n        \"enabled\": false,\n        \"liability\": null\n    },\n    \"billing_cycle_anchor\": 1747053731,\n    \"billing_cycle_anchor_config\": null,\n    \"cancel_at\": null,\n    \"cancel_at_period_end\": false,\n    \"canceled_at\": 1747053777,\n    \"cancellation_details\": {\n        \"comment\": null,\n        \"feedback\": null,\n        \"reason\": \"cancellation_requested\"\n    },\n    \"collection_method\": \"charge_automatically\",\n    \"created\": 1747053731,\n    \"currency\": \"eur\",\n    \"customer\": \"cus_SIWj6O1s3AdCZp\",\n    \"days_until_due\": null,\n    \"default_payment_method\": \"pm_1RNvgNP71JLI6sb9kNKVMddk\",\n    \"default_source\": null,\n    \"default_tax_rates\": [],\n    \"description\": null,\n    \"discounts\": [],\n    \"ended_at\": 1747053777,\n    \"invoice_settings\": {\n        \"account_tax_ids\": null,\n        \"issuer\": {\n            "}
[2025-05-12 12:42:57] [EVENT] SubscriptionMapper: Usando 'start_date' como 'current_period_start'. - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:57] [EVENT] SubscriptionMapper: Usando 'items.data[0].current_period_end'. - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:57] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Subscription DTO mapeado para eliminación/cancelación. - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d","sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg","status_from_payload":"canceled"}
[2025-05-12 12:42:57] [EVENT] SubscriptionModelFactory: Actualizando SubscriptionsModel desde SubscriptionDTO. - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg","new_status":"canceled"}
[2025-05-12 12:42:57] [EVENT] SubscriptionModelFactory: SubscriptionsModel actualizado. - Context: {"sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:57] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Suscripción marcada como eliminada/cancelada y guardada. - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d","sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg","final_status":"canceled"}
[2025-05-12 12:42:57] [EVENT] App\Strategy\Impl\SubscriptionDeletedStrategyImpl: Procesamiento completado. - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d","sub_id":"sub_1RNvgPP71JLI6sb9xZKJnhLg"}
[2025-05-12 12:42:57] [EVENT] StripeWebhookService: Estrategia procesada exitosamente. - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d","strategy_class":"App\\Strategy\\Impl\\SubscriptionDeletedStrategyImpl"}
[2025-05-12 12:42:57] [EVENT] StripeWebhookController: Webhook procesado exitosamente. - Context: {"event_id":"evt_1RNvh7P71JLI6sb9BefuTg9d"}
[2025-05-12 12:43:00] [EVENT] Bootstrap: .env cargado.
[2025-05-12 12:43:00] [EVENT] Bootstrap: Inicializado. Constantes definidas.
[2025-05-12 12:43:00] [EVENT] Bootstrap: GlobalStripeClient instanciado.
[2025-05-12 12:43:00] [EVENT] Bootstrap: StripeSubscriptionManagementService instanciado.
[2025-05-12 12:43:00] [EVENT] Bootstrap: StripeSubscriptionController instanciado.
[2025-05-12 12:43:00] [EVENT] API [api-subscriptions.php]: Solicitud para suscripciones del cliente. - Context: {"customer_id":"cus_SIWj6O1s3AdCZp","page":1,"limit":5}
[2025-05-12 12:43:00] [EVENT] App\Controller\Impl\StripeSubscriptionControllerImpl: Solicitando suscripciones para cliente. - Context: {"stripe_customer_id":"cus_SIWj6O1s3AdCZp","page":1,"limit":5}
